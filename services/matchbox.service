[Unit]
Description=CoreOS matchbox Server
After=docker.service cluster-config.service
Requires=docker.service cluster-config.service

[Service]
Environment="MATCHBOX_PATH=/etc/cluster-config/matchbox"
ExecStartPre=-/usr/bin/docker kill matchbox
ExecStartPre=-/usr/bin/docker rm matchbox
ExecStartPre=/usr/bin/docker pull quay.io/coreos/matchbox
ExecStart=/usr/bin/docker run --name=matchbox --net=host \
  -v ${MATCHBOX_PATH}:/var/lib/matchbox:Z \
  -v ${MATCHBOX_PATH}/etc:/etc/matchbox:Z,ro \
  quay.io/coreos/matchbox \
    -address=10.10.10.10:8080 \
    -rpc-address=10.10.10.10:8081 \
    -log-level=debug \
    -assets-path=/var/lib/matchbox/assets
ExecStop=/usr/bin/docker stop matchbox
Restart=always

[Install]
WantedBy=multi-user.target
